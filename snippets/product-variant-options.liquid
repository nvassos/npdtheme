{% comment %}
  Renders product variant options

  Accepts:
  - product: {Object} Product object
  - block: {Object} Block object
  - picker_type: {String} 'button' or 'dropdown'
{% endcomment %}

{%- unless product.has_only_default_variant -%}
  <variant-selects class="product-variant-selects" data-url="{{ product.url }}">
    {%- for option in product.options_with_values -%}
      <div class="product-option-section" data-option-name="{{ option.name | handle }}">
        <div class="option-label">{{ option.name | upcase }}</div>
        
        <div class="option-buttons" data-option-position="{{ forloop.index }}">
          {%- for value in option.values -%}
            {%- liquid
              assign is_selected = false
              if forloop.parentloop.index == 1 and product.selected_or_first_available_variant.option1 == value
                assign is_selected = true
              elsif forloop.parentloop.index == 2 and product.selected_or_first_available_variant.option2 == value
                assign is_selected = true
              elsif forloop.parentloop.index == 3 and product.selected_or_first_available_variant.option3 == value
                assign is_selected = true
              endif
            -%}
            
            <button 
              type="button"
              class="option-button {% if is_selected %}selected{% endif %}"
              data-option-value="{{ value | escape }}"
              data-{{ option.name | handle }}="{{ value | escape }}"
            >
              <span class="option-name">{{ value }}</span>
            </button>
          {%- endfor -%}
        </div>
      </div>
    {%- endfor -%}
    
    <script type="application/json" class="product-variants-json">
      {
        "variants": [
          {%- for variant in product.variants -%}
            {
              "id": {{ variant.id | json }},
              "title": {{ variant.title | json }},
              "option1": {{ variant.option1 | json }},
              "option2": {{ variant.option2 | json }},
              "option3": {{ variant.option3 | json }},
              "sku": {{ variant.sku | json }},
              "available": {{ variant.available | json }},
              "price": {{ variant.price | json }},
              "compare_at_price": {{ variant.compare_at_price | json }},
              "inventory_quantity": {{ variant.inventory_quantity | json }},
              "metafields": {
                "custom": {
                  "quickship_inventory": {{ variant.metafields.custom.quickship_inventory | default: 0 | json }},
                  "item_cost": {{ variant.metafields.custom.item_cost | json }}
                }
              }
            }{% unless forloop.last %},{% endunless %}
          {%- endfor -%}
        ]
      }
    </script>
  </variant-selects>
{%- endunless -%}

